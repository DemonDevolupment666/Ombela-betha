<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Ombela Market</title>
    <link rel="stylesheet" href="styles/global.css"/>
    <style>
        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .admin-panel {
            background: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .admin-panel h2 {
            color: #0a0f2c;
            margin-bottom: 30px;
            font-size: 2rem;
        }

        .admin-actions {
            margin-bottom: 30px;
        }

        .btn-primary {
            background: #0084ff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background 0.3s;
        }

        .btn-primary:hover {
            background: #0066cc;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
        }

        .btn-edit {
            background: #f59e0b;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 5px;
        }

        .btn-delete {
            background: #dc2626;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
        }

        .admin-table th {
            background: #0a0f2c;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .admin-table td {
            padding: 15px;
            border-bottom: 1px solid #e5e7eb;
        }

        .admin-table tr:hover {
            background: #f9fafb;
        }

        .produto-form {
            background: #f9fafb;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 30px;
            border: 2px solid #e5e7eb;
        }

        .produto-form h3 {
            color: #0a0f2c;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 1rem;
            font-family: inherit;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }

        #form-container {
            display: none;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #0084ff 0%, #00a2ff 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            font-size: 2.5rem;
            margin: 0;
            margin-bottom: 10px;
        }

        .stat-card p {
            margin: 0;
            opacity: 0.9;
            font-size: 1rem;
        }

        .import-export {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .import-export button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }

        .btn-export {
            background: #10b981;
            color: white;
        }

        .btn-import {
            background: #6366f1;
            color: white;
        }

        /* NavegaÃ§Ã£o Admin */
        .admin-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 10px;
        }

        .admin-nav-btn {
            padding: 12px 24px;
            border: none;
            background: transparent;
            color: #6b7280;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            position: relative;
        }

        .admin-nav-btn:hover {
            color: #0084ff;
        }

        .admin-nav-btn.active {
            color: #0084ff;
            border-bottom-color: #0084ff;
        }

        .badge {
            background: #dc2626;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            margin-left: 5px;
        }

        .admin-section {
            display: none;
        }

        .admin-section.active {
            display: block;
        }

        /* Estilos de Pedidos */
        .pedidos-panel {
            background: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .pedidos-panel h2 {
            color: #0a0f2c;
            margin-bottom: 30px;
            font-size: 2rem;
        }

        .pedidos-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .pedidos-stats .stat-card {
            padding: 20px;
            border-radius: 10px;
            color: white;
        }

        .pedidos-stats .stat-card.pendente {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .pedidos-stats .stat-card.aprovado {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .pedidos-stats .stat-card.rejeitado {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .pedidos-stats .stat-card.total {
            background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
        }

        .pedidos-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 10px 20px;
            border: 2px solid #e5e7eb;
            background: white;
            color: #6b7280;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .filter-btn:hover {
            border-color: #0084ff;
            color: #0084ff;
        }

        .filter-btn.active {
            background: #0084ff;
            color: white;
            border-color: #0084ff;
        }

        .pedidos-lista {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .pedido-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s;
        }

        .pedido-card:hover {
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .pedido-card.status-pendente {
            border-left: 5px solid #f59e0b;
        }

        .pedido-card.status-aprovado {
            border-left: 5px solid #10b981;
        }

        .pedido-card.status-rejeitado {
            border-left: 5px solid #ef4444;
        }

        .pedido-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e5e7eb;
        }

        .pedido-header h3 {
            margin: 0;
            color: #0a0f2c;
            font-size: 1.5rem;
        }

        .pedido-data {
            color: #6b7280;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .pedido-status {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .pedido-status.status-pendente {
            background: #fef3c7;
            color: #92400e;
        }

        .pedido-status.status-aprovado {
            background: #d1fae5;
            color: #065f46;
        }

        .pedido-status.status-rejeitado {
            background: #fee2e2;
            color: #991b1b;
        }

        .pedido-body h4 {
            color: #374151;
            margin-bottom: 15px;
        }

        .pedido-itens {
            list-style: none;
            padding: 0;
            margin: 0 0 20px 0;
        }

        .pedido-itens li {
            display: flex;
            gap: 15px;
            padding: 15px;
            background: #f9fafb;
            border-radius: 8px;
            margin-bottom: 10px;
            align-items: center;
        }

        .pedido-itens img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 6px;
        }

        .item-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .item-info strong {
            color: #0a0f2c;
        }

        .item-info span {
            font-size: 0.9rem;
            color: #6b7280;
        }

        .item-total {
            font-weight: bold;
            color: #0a0f2c;
            font-size: 1.1rem;
        }

        .pedido-totais {
            background: #f9fafb;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .total-linha {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
        }

        .total-linha.total-final {
            border-top: 2px solid #e5e7eb;
            margin-top: 10px;
            padding-top: 15px;
            font-size: 1.2rem;
        }

        .pedido-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e5e7eb;
        }

        .btn-aprovar {
            flex: 1;
            padding: 12px 24px;
            background: #10b981;
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .btn-aprovar:hover {
            background: #059669;
        }

        .btn-rejeitar {
            flex: 1;
            padding: 12px 24px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .btn-rejeitar:hover {
            background: #dc2626;
        }

        .status-info {
            padding: 15px;
            border-radius: 6px;
            text-align: center;
            font-weight: 600;
        }

        .status-info.aprovado {
            background: #d1fae5;
            color: #065f46;
        }

        .status-info.rejeitado {
            background: #fee2e2;
            color: #991b1b;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
        }

        .empty-state p {
            font-size: 1.2rem;
        }
    </style>
</head>
<body>
    <!-- NAVBAR -->
    <div class="navbar">
        <div class="header-inner-content">
           <h1 class="logo">OMBELA<span> MARKET</span></h1>
           <nav>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="lojas.html">Lojas</a></li>
                    <li><a href="produtos.html">Produtos</a></li>
                    <li><a href="sobre.html">Sobre</a></li>
                    <li><a href="contactos.html">Contactos</a></li>
                    <li><a href="admin.html" style="color: #00a2ff;">Admin</a></li>
                </ul>
           </nav>
        </div>
    </div>

    <div class="admin-container">
        <!-- Menu de NavegaÃ§Ã£o -->
        <div class="admin-nav">
            <button class="admin-nav-btn active" onclick="mostrarSecao('produtos')" id="btn-produtos">
                ðŸ“¦ Produtos
            </button>
            <button class="admin-nav-btn" onclick="mostrarSecao('pedidos')" id="btn-pedidos">
                ðŸ›’ Pedidos
                <span id="pedidos-pendentes-badge" class="badge">0</span>
            </button>
        </div>

        <!-- SeÃ§Ã£o Produtos -->
        <div id="secao-produtos" class="admin-section active">
            <!-- EstatÃ­sticas -->
            <div class="stats-grid" id="stats-grid">
                <!-- EstatÃ­sticas serÃ£o carregadas dinamicamente -->
            </div>

            <!-- Importar/Exportar -->
            <div class="import-export">
                <button class="btn-export" onclick="adminController.exportarProdutos()">
                    ðŸ“¥ Exportar Produtos (JSON)
                </button>
                <input type="file" id="importFile" accept=".json" style="display: none;" 
                       onchange="handleImport(event)">
                <button class="btn-import" onclick="document.getElementById('importFile').click()">
                    ðŸ“¤ Importar Produtos (JSON)
                </button>
            </div>

            <!-- Painel de AdministraÃ§Ã£o -->
            <div id="admin-content">
                <!-- ConteÃºdo serÃ¡ carregado dinamicamente -->
            </div>
        </div>

        <!-- SeÃ§Ã£o Pedidos -->
        <div id="secao-pedidos" class="admin-section">
            <div id="pedidos-content">
                <!-- ConteÃºdo de pedidos serÃ¡ carregado dinamicamente -->
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <footer class="footer">
        <div class="header-inner-content footer-grid">
            <div class="footer-col">
                <h3>OMBELA MARKET</h3>
                <p>
                    Marketplace e serviÃ§o de entregas focado em qualidade,
                    inovaÃ§Ã£o e acesso facilitado a produtos em Angola.
                </p>
            </div>

            <div class="footer-col">
                <h4>Links RÃ¡pidos</h4>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="produtos.html">Produtos</a></li>
                    <li><a href="sobre.html">Sobre</a></li>
                    <li><a href="contactos.html">Contactos</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h4>Contactos</h4>
                <p>Email: contato@ombelamarket.com</p>
                <p>Telefone: +244 936 408 070</p>
                <p>Angola</p>
            </div>
        </div>

        <div class="footer-bottom">
            <p>Â© 2026 Ombela Market â€” Todos os direitos reservados</p>
        </div>
    </footer>

    <!-- Scripts MVC -->
    <script src="models/Produto.js"></script>
    <script src="models/Carrinho.js"></script>
    <script src="models/Pedido.js"></script>
    <script src="models/ProdutoRepository.js"></script>
    <script src="controllers/AdminController.js"></script>
    <script src="controllers/PedidosAdminController.js"></script>
    
    <!-- InicializaÃ§Ã£o -->
    <script>
        let adminController;
        let produtoRepository;
        let pedidosAdmin;
        let pedidoRepository;

        // FunÃ§Ã£o para mostrar seÃ§Ã£o
        function mostrarSecao(secao) {
            // Atualizar botÃµes
            document.querySelectorAll('.admin-nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById('btn-' + secao).classList.add('active');

            // Atualizar seÃ§Ãµes
            document.querySelectorAll('.admin-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById('secao-' + secao).classList.add('active');

            // Carregar conteÃºdo se necessÃ¡rio
            if (secao === 'pedidos') {
                carregarPedidos();
            }
        }

        // FunÃ§Ã£o para carregar pedidos
        function carregarPedidos() {
            const pedidosContent = document.getElementById('pedidos-content');
            pedidosContent.innerHTML = pedidosAdmin.renderizarPainelPedidos();
        }

        // FunÃ§Ã£o para lidar com importaÃ§Ã£o
        function handleImport(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        adminController.importarProdutos(e.target.result);
                        renderizarEstatisticas();
                    } catch (error) {
                        alert('Erro ao importar arquivo: ' + error.message);
                    }
                };
                reader.readAsText(file);
            }
        }

        // Renderizar estatÃ­sticas
        function renderizarEstatisticas() {
            const produtos = produtoRepository.obterTodos();
            const totalProdutos = produtos.length;
            
            const totalValor = produtos.reduce((sum, p) => sum + p.preco, 0);
            const mediaPreco = totalProdutos > 0 ? totalValor / totalProdutos : 0;
            
            const categorias = [...new Set(produtos.map(p => p.categoria))];
            
            const statsHTML = `
                <div class="stat-card">
                    <h3>${totalProdutos}</h3>
                    <p>Total de Produtos</p>
                </div>
                <div class="stat-card">
                    <h3>${categorias.length}</h3>
                    <p>Categorias</p>
                </div>
                <div class="stat-card">
                    <h3>AO ${Math.round(mediaPreco).toLocaleString('pt-AO')}</h3>
                    <p>PreÃ§o MÃ©dio</p>
                </div>
            `;
            
            document.getElementById('stats-grid').innerHTML = statsHTML;
        }

        // Atualizar badge de pedidos pendentes
        function atualizarBadgePedidos() {
            const stats = pedidoRepository.getEstatisticas();
            const badge = document.getElementById('pedidos-pendentes-badge');
            if (badge) {
                badge.textContent = stats.pendentes;
                badge.style.display = stats.pendentes > 0 ? 'inline' : 'none';
            }
        }

        // Inicializar quando o DOM estiver carregado
        document.addEventListener('DOMContentLoaded', function() {
            produtoRepository = new ProdutoRepository();
            adminController = new AdminController(produtoRepository);
            pedidoRepository = new PedidoRepository();
            pedidosAdmin = new PedidosAdminController(pedidoRepository);
            
            // Renderizar painel de produtos
            const adminContent = document.getElementById('admin-content');
            adminContent.innerHTML = adminController.renderizarPainelAdmin();
            
            // Renderizar estatÃ­sticas
            renderizarEstatisticas();
            
            // Atualizar badge de pedidos
            atualizarBadgePedidos();

            // Atualizar badge periodicamente (a cada 30 segundos)
            setInterval(atualizarBadgePedidos, 30000);
        });
    </script>
</body>
</html>
